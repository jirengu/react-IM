(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,n){},29:function(e,t,n){e.exports=n(60)},34:function(e,t,n){},36:function(e,t,n){},39:function(e,t,n){},41:function(e,t,n){},47:function(e,t,n){},49:function(e,t,n){},51:function(e,t,n){},53:function(e,t,n){},55:function(e,t,n){},57:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),s=(n(34),n(2)),i=n(3),l=n(5),u=n(4),p=n(6),m=(n(36),n(12));n(21);function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};return function(t){["componentWillMount","render","componentDidMount","componentWillUpdate","shouldComponentUpdate","componentDidUpdate","componentWillReceiveProps","componentWillUnmount"].forEach(function(n){var a="shouldComponentUpdate"===n||function(){return null},r=t.prototype[n]||a;t.prototype[n]=function(){try{return r.call(this,arguments)}catch(c){var a={displayName:t.name,method:n,state:this.state,props:this.props,message:c.stack};e.errorHandler&&console.error("Error",a),e.errorHandler=e.errorHandler||function(e){console.error("Error",e)},e.errorHandler(a)}}})}}n(39),a.Component,n(41);var f,h,g=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props[0];return r.a.createElement("div",{className:"tip ".concat(e.type||this.props.type)},r.a.createElement("section",null,e.title||this.props.title))}}]),t}(a.Component);function b(){f&&v(),f=document.createElement("div"),document.body.appendChild(f),o.a.render(r.a.createElement(g,arguments),f),h&&clearInterval(h),h=setTimeout(function(){v()},2e3)}function v(){f&&(o.a.unmountComponentAtNode(f),f.parentNode.removeChild(f),f=null)}g.defaultProps={title:"\u6210\u529f",type:"success"};var y,E=window.WebIM,j=new E.connection({isMultiLoginSessions:E.config.isMultiLoginSessions,https:!1,url:E.config.xmppURL,heartBeatWait:E.config.heartBeatWait,autoReconnectNumMax:E.config.autoReconnectNumMax,autoReconnectInterval:E.config.autoReconnectInterval,apiUrl:E.config.apiURL,isHttpDNS:E.config.isHttpDNS,isWindowSDK:E.config.isWindowSDK,isAutoLogin:!0,encrypt:E.config.encrypt,delivery:E.config.delivery,appkey:E.config.appkey}),O=E={conn:j},C=n(9),w="reg_state",k="chat_state",N="friend_list",x="set_current",F="msg_list";var I,H=Object(C.b)(function(e){return{regState:e.sign.regState}},{regist:function(e){return function(t){return new Promise(function(n,a){e.success,e.error,e.success=function(){t({type:w,payload:{state:2}}),n()},e.error=function(e){t({type:w,payload:{state:3}}),a(e)},t({type:w,payload:{state:1}}),O.conn.registerUser(e)})}}})(y=d({errorHandler:function(e){}})(y=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).signup=function(){var e=n.refs.username.value.trim(),t=n.refs.password.value.trim(),a=n.refs.nickname.value.trim();if(e&&t&&a){var r={username:e,password:t,nickname:a,appKey:"seventcq#react-im",apiUrl:"http://a1.easemob.com"};n.props.regist(r).then(function(){b({title:"\u6ce8\u518c\u6210\u529f",type:"success"}),n.props.history.push("/signin")}).catch(function(e){b({title:"\u7528\u6237\u5df2\u5b58\u5728",type:"error"})})}else b({title:"\u8bf7\u5c06\u4fe1\u606f\u586b\u5199\u5b8c\u6574",type:"error"})},n.state={name:"chiuyung"},n.signup=n.signup.bind(Object(m.a)(Object(m.a)(n))),n}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"BG"},r.a.createElement("section",{className:"sign-wrapper"},r.a.createElement("h3",null,"\u6ce8\u518c"),r.a.createElement("input",{ref:"username",type:"text",name:"username",placeholder:"\u7528\u6237\u540d"}),r.a.createElement("input",{ref:"password",type:"password",name:"password",placeholder:"\u5bc6\u7801"}),r.a.createElement("input",{ref:"nickname",type:"text",name:"nickname",placeholder:"\u6635\u79f0"}),r.a.createElement("button",{onClick:this.signup},"\u6ce8\u518c")))}}]),t}(a.Component))||y)||y,M=n(61),W="";function U(){return W}var S=Object(C.b)(function(e){return{regState:e.sign.regState}},{loginAction:function(e){return function(t){return new Promise(function(t,n){e.success,e.error,e.success=function(e){t(e)},e.error=function(e){n(e)},O.conn.open(e)})}}})(I=d({errorHandler:function(e){}})(I=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).signin=function(){var t=e.refs.username.value.trim(),n=e.refs.password.value.trim();if(t&&n){var a={user:t,pwd:n,appKey:"seventcq#react-im",apiUrl:"http://a1.easemob.com"};(0,e.props.loginAction)(a).then(function(t){b({title:"\u767b\u5f55\u6210\u529f",type:"success"}),W=t,e.props.history.push("/chatroom")}).catch(function(e){b({title:"\u672a\u77e5\u9519\u8bef",type:"error"})})}else b({title:"\u8bf7\u5c06\u4fe1\u606f\u586b\u5199\u5b8c\u6574",type:"error"})},e.state={name:"chiuyung"},e.signin=e.signin.bind(Object(m.a)(Object(m.a)(e))),e}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"BG"},r.a.createElement("section",{className:"sign-wrapper"},r.a.createElement("h3",null,"\u767b\u5f55"),r.a.createElement("input",{ref:"username",type:"text",name:"username",placeholder:"\u7528\u6237\u540d"}),r.a.createElement("input",{ref:"password",type:"password",name:"password",placeholder:"\u5bc6\u7801"}),r.a.createElement("button",{onClick:this.signin},"\u767b\u5f55"),r.a.createElement("p",null,"\u6ca1\u6709\u8d26\u53f7\uff0c",r.a.createElement(M.a,{to:"/signup"},"\u6ce8\u518c"))))}}]),t}(a.Component))||I)||I;n(47),n(49);n(51);var A,R,B=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).close=function(){L()},n.add=function(){O.conn.subscribe({to:n.refs.addname.value,message:"\u52a0\u4e2a\u597d\u53cb\u5457!"}),b({title:"\u53d1\u9001\u6210\u529f",type:"success"}),L()},n}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"addfriend-wrapper"},r.a.createElement("section",{className:"addfriend"},r.a.createElement("header",null,r.a.createElement("span",null,"\u6dfb\u52a0\u597d\u53cb"),r.a.createElement("span",{onClick:this.close},"x")),r.a.createElement("main",null,r.a.createElement("input",{ref:"addname",type:"text",placeholder:"\u7528\u6237\u540d"})),r.a.createElement("footer",null,r.a.createElement("button",{onClick:this.add},"\u6dfb\u52a0"))))}}]),t}(a.Component);function L(){A&&(o.a.unmountComponentAtNode(A),A.parentNode.removeChild(A),A=null)}var P,T=Object(C.b)(function(e){return{selectItem:e.chatselect.selectItem}},{chatChange:function(e){return function(t){return new Promise(function(n,a){t({type:k,payload:{state:e}}),n(e)})}}})(R=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).singleChat=function(){n.props.chatChange(1).then(function(e){n.setState({selectindex:e,singleChat:!0})})},n.groupChat=function(){n.props.chatChange(2).then(function(e){n.setState({selectindex:e,singleChat:!1})})},n.addFriend=function(){A&&L(),A=document.createElement("div"),document.body.appendChild(A),o.a.render(r.a.createElement(B,null),A)},n.state={selectindex:n.props.selectItem,singleChat:!0},n}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=U(),t=e?e.user.username:"\u8bf7\u91cd\u65b0\u767b\u5f55";return r.a.createElement("section",{className:"sliderBar"},r.a.createElement("header",null,r.a.createElement("svg",{className:"icon","aria-hidden":"true"},r.a.createElement("use",{xlinkHref:"#icon-user"})),r.a.createElement("p",{className:"username"},t)),r.a.createElement("div",{className:"singleChat",onClick:this.singleChat},r.a.createElement("svg",{className:"icon ".concat(!0===this.state.singleChat?"active":""),"aria-hidden":"true"},r.a.createElement("use",{xlinkHref:"#icon-chat"}))),r.a.createElement("div",{className:"groupChat",onClick:this.groupChat},r.a.createElement("svg",{className:"icon ".concat(!1===this.state.singleChat?"active":""),"aria-hidden":"true"},r.a.createElement("use",{xlinkHref:"#icon-chatbubbles"}))),r.a.createElement("div",{className:"setting active",onClick:this.addFriend},r.a.createElement("svg",{className:"icon","aria-hidden":"true"},r.a.createElement("use",{xlinkHref:"#icon-setting"}))))}}]),t}(a.Component))||R,D=(n(53),n(24)),_=new(n.n(D).a),K=(n(55),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).acceptHandle=function(){O.conn.subscribed({to:n.props.from,message:"[resp:true]"}),q()},n.unacceptHandle=function(){O.conn.unsubscribed({to:n.props.from,message:"rejectAddFriend"}),q()},console.log(n.props),n}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"receive-wrapper"},r.a.createElement("div",{className:"receive"},r.a.createElement("header",null,"\u6dfb\u52a0\u597d\u53cb\u8bf7\u6c42"),r.a.createElement("main",null,this.props.from," : ",this.props.status),r.a.createElement("footer",null,r.a.createElement("button",{onClick:this.unacceptHandle},"\u62d2\u7edd"),r.a.createElement("button",{onClick:this.acceptHandle},"\u540c\u610f"))))}}]),t}(a.Component));function q(){P&&(o.a.unmountComponentAtNode(P),P.parentNode.removeChild(P),P=null)}function G(){return function(e){return new Promise(function(t,n){O.conn.getRoster({success:function(n){n=n.filter(function(e){return"both"===e.subscription}),e({type:N,payload:{data:n}}),t(n)},error:function(e){n(e)}})})}}var J,$,z=n(15),Q=n.n(z),V=Object(C.b)(function(e){return{rosters:e.session,currentFriend:e.session.currentFriend}},{getRosters:G})(J=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleMessage=function(e){!function(e){P&&q(),P=document.createElement("div"),document.body.appendChild(P),o.a.render(r.a.createElement(K,e),P)}(e)},n}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){_.on("presenceApply",this.handleMessage)}},{key:"componentWillUnmount",value:function(){console.log("\u6d88\u9664\u7ec4\u4ef6"),_.removeListener("presenceApply",this.handleMessage)}},{key:"render",value:function(){var e=this,t=this.props.rosters.rosters;return r.a.createElement("div",{className:"people-wrapper"},t.length?t.map(function(t){return r.a.createElement(X,{roster:t,key:t.name,selectName:e.props.currentFriend})}):r.a.createElement("span",null))}}]),t}(a.Component))||J,X=Object(C.b)(function(e){return{currentFriend:e.session.currentFriend}},{setCurrentFriend:function(e){return function(t){t({type:x,payload:{current:e}})}}})($=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).clickItem=function(){var e={groups:n.props.roster.groups,jid:n.props.roster.jid,name:n.props.roster.name,subscription:n.props.roster.subscription};n.props.setCurrentFriend(e)},n}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.selectName||{name:""},t=("/chatroom/single/".concat(this.props.roster.name),Q()({"bubbleitem-wrapper":!0,active:this.props.roster.name===e.name}));return r.a.createElement("div",{className:t,onClick:this.clickItem},r.a.createElement("a",{className:"bubbleitem-wrapper-a"},r.a.createElement("span",{className:"header"},r.a.createElement("svg",{className:"icon","aria-hidden":"true"},r.a.createElement("use",{xlinkHref:"#icon-user"}))),r.a.createElement("span",{className:"messageinfo"},r.a.createElement("p",null,this.props.roster.name),r.a.createElement("p",null))))}}]),t}(a.Component))||$;n(57);var Y,Z,ee=Object(C.b)(function(e){return{currentFriend:e.session.currentFriend,msgList:e.message.msglist}},{sendMessage:function(e,t){return function(n){var a=U(),r=a?a.user.username:"",c=O.conn.getUniqueId(),o=new window.WebIM.message("txt",c);o.set({msg:e,to:t,roomType:!1,success:function(a,c){n({type:F,payload:{msg:e,to:t,id:c,from:r}})},fail:function(e){console.log("\u53d1\u9001\u5931\u8d25")}}),o.body.chatType="singleChat",O.conn.send(o.body)}}})(Y=d(function(e){})(Y=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).sendText=function(){(0,n.props.sendMessage)(n.refs.text.value,n.props.currentFriend.name),n.refs.text.value=""},n}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(){return!0}},{key:"render",value:function(){var e=this.props.currentFriend.name,t=this.props.msgList[e]||[];return r.a.createElement("div",{className:"Bubblue-wrapper"},r.a.createElement("header",null,this.props.currentFriend.name),r.a.createElement("main",null,t.map(function(e){return r.a.createElement(te,{message:e,key:e.id})})),r.a.createElement("footer",null,r.a.createElement("div",{className:"textarea"},r.a.createElement("textarea",{ref:"text",name:"",id:"",cols:"30",rows:"10"})),r.a.createElement("button",{onClick:this.sendText},"\u53d1\u9001")))}}]),t}(a.Component))||Y)||Y,te=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=U(),t=e?e.user.username:"",n=Q()({Bubblueitemwrapper:!0,right:t===this.props.message.from});return r.a.createElement("div",{className:n},r.a.createElement("span",{className:"header"},r.a.createElement("svg",{className:"icon","aria-hidden":"true"},r.a.createElement("use",{xlinkHref:"#icon-user"}))),r.a.createElement("div",{className:"content-wrapper"},r.a.createElement("p",{className:"name"},this.props.message.from),r.a.createElement("div",{className:"content"},this.props.message.msg)))}}]),t}(a.Component),ne=Object(C.b)(function(e){return{selctItem:e.chatselect.selctItem,currentFriend:e.session.currentFriend}},{mesInit:function(){return function(e){O.conn.listen({onOpened:function(t){e(G())},onTextMessage:function(t){console.log("\u6536\u5230\u6d88\u606f",t),e({type:F,payload:{msg:t.data,to:t.from,id:t.id,from:t.from}})},onRoster:function(t){console.log("\u597d\u53cb\u5217\u8868",t),e(G())},onPresence:function(e){_.emit("presenceApply",e)}})}}})(Z=d(function(e){})(Z=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){U()?this.props.mesInit():this.props.history.push("/signin")}},{key:"shouldComponentUpdate",value:function(){return!0}},{key:"render",value:function(){return r.a.createElement("div",{className:"room-wrapper"},r.a.createElement("div",{className:"room"},r.a.createElement(T,null),r.a.createElement(V,null),null!==this.props.currentFriend?r.a.createElement(ee,null):null))}}]),t}(a.Component))||Z)||Z,ae=n(13);var re=n(28),ce=n(27);function oe(e,t,n,a,r){var c=r[a]||[];return c.push({msg:e,id:t,from:n}),r[a]=c,Object.assign({},r)}var se=n(25),ie={sign:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{regState:1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return Object.assign(e,{regState:t.payload.state});default:return e}},session:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rosters:[],currentFriend:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return Object.assign({},e,{rosters:Object(ce.a)(t.payload.data)});case x:return Object.assign({},e,{currentFriend:Object(re.a)({},t.payload.current)});default:return e}},chatselect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{selectItem:1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return Object.assign(e,{selctItem:t.payload.state});default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{msglist:{}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return Object.assign({},e,{msglist:oe(t.payload.msg,t.payload.id,t.payload.from,t.payload.to,e.msglist)});default:return e}}},le=Object(ae.c)(ie),ue=[se.a],pe=ae.a.apply(void 0,ue)(ae.d)(le),me=n(63),de=n(62),fe=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){U()?this.props.mesInit():this.props.history.push("/signin")}},{key:"render",value:function(){return r.a.createElement("div",{className:"main"},this.props.children)}}]),t}(a.Component),he=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement(C.a,{store:pe},r.a.createElement(me.a,null,r.a.createElement("div",null,r.a.createElement(de.a,{exact:!0,path:"/",component:fe}),r.a.createElement(de.a,{path:"/signin",component:S}),r.a.createElement(de.a,{path:"/signup",component:H}),r.a.createElement(de.a,{path:"/chatroom",component:ne},"/*",r.a.createElement(de.a,{path:"/:chatType/:chatId",component:ne}),"*/"))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(he,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[29,2,1]]]);
//# sourceMappingURL=main.cc4a5a41.chunk.js.map